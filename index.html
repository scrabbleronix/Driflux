<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Driflux</title>
    <link rel="icon" href="driflux.ico" type="image/x-icon">
    <link rel="manifest" href="manifest.json">
    <style>
      body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        overflow: hidden;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        text-align: center;
        position: relative;
        background: linear-gradient(45deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6));
        background-size: 400% 400%;
        animation: gradientAnimation 20s ease infinite;
      }
      h1 {
        font-size: 3rem;
        margin-bottom: 20px;
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
      }
      #question {
        font-size: 1.5rem;
        margin-bottom: 30px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }
      .container {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 30px;
        flex-direction: column;
      }
      .draggable {
        width: 120px;
        height: 50px;
        background-color: #42a5f5;
        color: white;
        text-align: center;
        line-height: 50px;
        cursor: pointer;
        border-radius: 10px;
        transition: transform 0.2s ease;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
      }
      .draggable:active {
        transform: scale(0.95);
      }
      .dropzone {
        width: 100%;
        height: 100px;
        border: 4px dashed #42a5f5;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        color: #42a5f5;
        margin: 10px 0;
        transition: background-color 0.3s ease, transform 0.2s ease;
      }
      .dropzone.correct {
        background-color: #4caf50;
        color: white;
        animation: dropzone-pulse 0.5s ease-out;
      }

      #timer {
        font-size: 1.2rem;
        position: absolute;
        top: 20px;
        right: 20px;
      }
      #score {
        font-size: 1.5rem;
        position: absolute;
        bottom: 20px;
        left: 20px;
      }
      .progress-bar {
        width: 100%;
        height: 10px;
        background-color: #ccc;
        margin-top: 20px;
        border-radius: 5px;
      }
      .progress {
        height: 100%;
        background-color: #42a5f5;
        border-radius: 5px;
      }
      .button-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 10px;
      }
      button {
        padding: 10px 20px;
        font-size: 1.1rem;
        border: none;
        background-color: #42a5f5;
        color: white;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
      }
      button:disabled {
        background-color: #888;
        cursor: not-allowed;
      }
      button:hover {
        background-color: #2196f3;
      }
      .particle {
        position: absolute;
        width: 12px;
        height: 12px;
        background-color: #42a5f5;
        border-radius: 50%;
        animation: particle-burst 0.8s ease-out forwards;
        opacity: 0.8;
      }
      .correct-text {
        animation: correct-text-scale 0.3s ease-out forwards;
      }
      .incorrect-text {
        animation: incorrect-text-shake 0.5s ease-out forwards;
      }
      .combo-streak {
        position: absolute;
        top: 30px;
        font-size: 2rem;
        color: #fff;
        background-color: #42a5f5;
        padding: 10px 20px;
        border-radius: 10px;
        opacity: 0;
        transform: translateY(-50px);
        transition: opacity 0.3s ease, transform 0.3s ease;
        z-index: 10;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }
      .combo-streak-active {
        animation: fadeOut 1s ease-out forwards;
      }
      .combo-streak-correct {
        background-color: #4caf50;
        animation: combo-correct 1s ease-out forwards;
      }
      .combo-streak-wrong {
        background-color: #f44336;
        animation: combo-wrong 1s ease-out forwards;
      }
      .loading-screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: 2rem;
        z-index: 1000;
        opacity: 1;
        transition: opacity 0.5s ease;
      }
      .loader {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #42a5f5;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 2s linear infinite;
      }
      @keyframes dropzone-pulse {
        0% {
          transform: scale(1);
        }
        25% {
          transform: scale(1.1);
        }
        50% {
          transform: scale(1);
        }
        75% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }
      @keyframes particle-burst {
        0% {
          transform: translate(0, 0) scale(1) rotate(0deg);
          opacity: 1;
        }
        50% {
          transform: translate(var(--x), var(--y)) scale(1.5) rotate(90deg);
          opacity: 0.7;
        }
        100% {
          transform: translate(var(--x), var(--y)) scale(0.6) rotate(180deg);
          opacity: 0;
        }
      }
      @keyframes gradientAnimation {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      @keyframes correct-text-scale {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.2);
          opacity: 1;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      @keyframes incorrect-text-shake {
        0% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        50% {
          transform: translateX(10px);
        }
        75% {
          transform: translateX(-10px);
        }
        100% {
          transform: translateX(0);
        }
      }
      @keyframes combo-correct {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.2);
          opacity: 1;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      @keyframes combo-wrong {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.1);
          opacity: 0.8;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      @keyframes fadeOut {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <h1>Driflux</h1>
    <p id="question">Loading question...</p>

    <div class="container" id="draggable-container">
      <!-- Draggable elements will appear here -->
    </div>

    <div class="container">
      <div
        id="dropzone"
        class="dropzone"
        ondrop="drop(event)"
        ondragover="allowDrop(event)"
      >
        Drop the word here
      </div>
      <div class="button-container">
        <button id="freeze-btn" onclick="freezeTime()" disabled>
          Freeze Time
        </button>
        <button id="skip-btn" onclick="skipQuestion()" disabled>
          Skip Question
        </button>
      </div>
    </div>

    <div id="timer">Time Left: <span id="time-left">30</span> seconds</div>
    <div id="score">Score: 0</div>
    <div id="combo-streak" class="combo-streak">Combo Streak: 0</div>
    <div class="progress-bar"><div id="progress" class="progress"></div></div>

    <div id="loading-screen" class="loading-screen">
      <h2>Loading...</h2>
      <div class="loader"></div>
    </div>

    <script>
      let points = 0;
      let timeLeft = 30;
      let timerInterval;
      let progressInterval;
      let comboStreak = 0;
      let comboStreakActive = false;
      let skipAvailable = true;
      let freezeAvailable = true;
      let popupActive = false;
      let questionStartTime = 0;

      const questions = [
        {
          question: "Does the dog ___ the tin can?",
          correct: "chase",
          options: ["chase", "eat", "see"],
        },
        {
          question: "The cat ___ on the tree.",
          correct: "climbs",
          options: ["climbs", "runs", "sits"],
        },
        {
          question: "The bird ___ in the sky.",
          correct: "flies",
          options: ["flies", "sings", "hops"],
        },
        {
          question: "Does the mouse ___ the cheese?",
          correct: "eat",
          options: ["eat", "run", "chase"],
        },
        {
          question: "The fish ___ in the water.",
          correct: "swims",
          options: ["swims", "flies", "dives"],
        },
        {
          question: "The quick brown fox ___ over the lazy dog.",
          correct: "jumps",
          options: ["jumps", "rolls", "bends"],
        },
        {
          question: "Chai tea? Chai means '___,' my friend!",
          correct: "tea",
          options: ["tea", "mocha", "cappuccino"],
        },
        {
          question: "Can you say sandwich in Spanish? ___!",
          correct: "bocadillo",
          options: ["bocadillo", "zorra", "sándwich"],
        },
        {
          question: "I'm on a seafood diet. I ___ food and I eat it.",
          correct: "see",
          options: ["see", "cook", "buy"],
        },
        {
          question:
            "Why don’t scientists trust atoms? Because they ___ everything up.",
          correct: "make",
          options: ["make", "blow", "mix"],
        },
        {
          question:
            "I told my friend she was drawing her eyebrows too high. She looked ___.",
          correct: "surprised",
          options: ["surprised", "angry", "confused"],
        },
        {
          question: "To be, or not to be, that is the ___. (Shakespeare)",
          correct: "question",
          options: ["question", "answer", "dilemma"],
        },
        {
          question:
            "The only thing we have to fear is ___ itself. (F. D. Roosevelt)",
          correct: "fear",
          options: ["fear", "failure", "danger"],
        },
        {
          question: "I think, therefore I ___. (Descartes)",
          correct: "am",
          options: ["am", "exist", "think"],
        },
        {
          question:
            "In the Harry Potter series, the spell to disarm an opponent is ___!",
          correct: "Expelliarmus",
          options: ["Expelliarmus", "Avada Kedavra", "Lumos"],
        },
        {
          question: "In Star Wars, Darth Vader famously says, 'I am your ___.'",
          correct: "father",
          options: ["father", "brother", "master"],
        },
        {
          question:
            "In The Lord of the Rings, Frodo is tasked with destroying the One ___.",
          correct: "Ring",
          options: ["Ring", "Sword", "Amulet"],
        },
      ];

      let currentQuestion;

      function allowDrop(event) {
        event.preventDefault();
      }

      function showPopup(message) {
        if (popupActive) return;
        popupActive = true;

        const popup = document.createElement("div");
        popup.style.position = "absolute";
        popup.style.top = "30%";
        popup.style.left = "50%";
        popup.style.transform = "translate(-50%, -30%)";
        popup.style.backgroundColor = "rgba(0, 0, 0, 0.8)";
        popup.style.color = "#fff";
        popup.style.padding = "20px";
        popup.style.borderRadius = "10px";
        popup.style.fontSize = "1.5rem";
        popup.style.zIndex = "9999";
        popup.innerText = message;
        popup.style.animation = "popupShake 0.5s ease-in-out, popupScale 0.3s ease-in-out";

        const style = document.createElement("style");
        style.innerHTML = `
          @keyframes popupShake {
            0% { transform: translate(-50%, -30%) rotate(0deg); }
            25% { transform: translate(-50%, -30%) rotate(-10deg); }
            50% { transform: translate(-50%, -30%) rotate(10deg); }
            75% { transform: translate(-50%, -30%) rotate(-10deg); }
            100% { transform: translate(-50%, -30%) rotate(0deg); }
          }

          @keyframes popupScale {
            0% { transform: translate(-50%, -30%) scale(0.8); }
            100% { transform: translate(-50%, -30%) scale(1); }
          }
        `;

        document.head.appendChild(style);
        document.body.appendChild(popup);

        setTimeout(() => {
          document.body.removeChild(popup);
          popupActive = false;
        }, 2500);
      }

      function randomPopupDistraction() {
        const messages = [
          "Hold on tight! Quick Question! 🧐",
          "Don't panic, just focus! 😅",
          "Uh-oh! Here comes a distraction! 😈",
          "Can you handle the pressure? 😏",
          "Time's ticking! Better hurry up! ⏰",
          "Oops! Did you forget that answer? 😜",
          "You sure about that? 🤔",
          "Focus, you’re doing great! ✨",
          "Keep going! You got this! 💪",
          "Quick! Show us what you've got! 💥",
          "Uh-oh, a tricky one! Better think fast! ⚡",
          "Haha, wrong answer! Better luck next time! 😂"
        ];

        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        showPopup(randomMessage);
      }

      setInterval(randomPopupDistraction, Math.random() * (20000 - 10000) + 10000);

      function updateComboStreak(isCorrect) {
        const streakElement = document.getElementById("combo-streak");

        if (isCorrect) {
          comboStreak++;
          streakElement.innerText = `Combo Streak: ${comboStreak}`;
          streakElement.classList.add(
            "combo-streak-active",
            "combo-streak-correct"
          );
          streakElement.classList.remove("combo-streak-wrong");
        } else {
          comboStreak = 0;
          streakElement.innerText = `Combo Streak: 0`;
          streakElement.classList.add(
            "combo-streak-active",
            "combo-streak-wrong"
          );
          streakElement.classList.remove("combo-streak-correct");
        }

        setTimeout(() => {
          streakElement.classList.remove("combo-streak-active");
        }, 1000);
      }

      function createParticles(element) {
        const particleCount = 25;
        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement("div");
          particle.classList.add("particle");
          particle.style.setProperty("--x", `${Math.random() * 200 - 100}px`);
          particle.style.setProperty("--y", `${Math.random() * 200 - 100}px`);
          element.appendChild(particle);

          particle.addEventListener("animationend", () => {
            particle.remove();
          });
        }
      }

      function calculatePoints(timeTaken) {
        const maxPoints = 20;
        const minPoints = 5;

        const fastThreshold = 5000;

        if (timeTaken <= fastThreshold) {
          return maxPoints;
        } else {
          const penalty = Math.min((timeTaken - fastThreshold) / 1000, 10);
          return Math.floor(Math.max(maxPoints - penalty, minPoints));
        }
      }

      function drag(event) {
        event.dataTransfer.setData("text", event.target.id);
      }

      function drop(event) {
        event.preventDefault();
        let data = event.dataTransfer.getData("text");
        let draggedElement = document.getElementById(data);
        let dropzone = event.target;

        const timeTaken = Date.now() - questionStartTime;

        let optionText = data.replace("draggable-", "");
        if (optionText === currentQuestion.correct) {
          dropzone.innerText = optionText;
          dropzone.classList.add("correct");
          dropzone.classList.add("correct-text");
          createParticles(dropzone);
          points += calculatePoints(timeTaken);
          updateComboStreak(true);
          if (comboStreak >= 3) {
            points += 10;
            playSound("combo");
          }
          document.getElementById("score").innerText = `Score: ${points}`;
          playSound("correct");
        } else {
          dropzone.innerText = "Wrong word!";
          dropzone.classList.add("wrong");
          dropzone.classList.add("incorrect-text");
          updateComboStreak(false);
          playSound("wrong");
        }

        setTimeout(nextQuestion, 1000);
      }

      function freezeTime() {
        if (freezeAvailable) {
          timeLeft += 10;
          freezeAvailable = false;
          document.getElementById("freeze-btn").disabled = true;
          alert("Time frozen! You got 10 extra seconds.");
        }
      }

      function skipQuestion() {
        if (skipAvailable) {
          nextQuestion();
          skipAvailable = false;
          document.getElementById("skip-btn").disabled = true;
          alert("Question skipped!");
        }
      }

      function nextQuestion() {
        freezeAvailable = true;
        skipAvailable = true;
        document.getElementById("freeze-btn").disabled = false;
        document.getElementById("skip-btn").disabled = false;

        let dropzone = document.getElementById("dropzone");
        dropzone.innerText = "Drop the word here";
        dropzone.classList.remove('correct', 'wrong');

        currentQuestion =
          questions[Math.floor(Math.random() * questions.length)];
        document.getElementById("question").innerText =
          currentQuestion.question;

        const shuffledOptions = shuffle([...currentQuestion.options]);
        const container = document.getElementById("draggable-container");
        container.innerHTML = "";
        shuffledOptions.forEach((option) => {
          let draggable = document.createElement("div");
          draggable.classList.add("draggable");
          draggable.id = `draggable-${option}`;
          draggable.draggable = true;
          draggable.innerText = option;
          draggable.addEventListener("dragstart", drag);
          container.appendChild(draggable);
        });

        resetTimer();
      }

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]]; // Swap
        }
        return array;
      }

      function startTimer() {
        questionStartTime = Date.now();
        timerInterval = setInterval(() => {
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            alert("Time's up! Let's move to the next question.");
            nextQuestion();
          } else {
            timeLeft--;
            document.getElementById("time-left").innerText = timeLeft;
            updateProgressBar();
          }
        }, 1000);
      }

      function resetTimer() {
        timeLeft = 30;
        document.getElementById("time-left").innerText = timeLeft;
        clearInterval(timerInterval);
        updateProgressBar();
        startTimer();
      }

      function updateProgressBar() {
        const progress = document.getElementById("progress");
        const percentage = (timeLeft / 30) * 100;
        progress.style.width = percentage + "%";
      }

      function playSound(type) {
        const audio = new Audio(
          type === "correct"
            ? "sounds/correct-sound.mp3"
            : type === "wrong"
            ? "sounds/wrong-sound.mp3"
            : type === "combo"
            ? "sounds/combo-sound.mp3"
            : "sounds/default-sound.mp3"
        );

        audio.play();
      }

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js')
          .then((registration) => {
            console.log('Service Worker registered with scope:', registration.scope);
          })
          .catch((error) => {
            console.log('Service Worker registration failed:', error);
          });
        });
    }

      document.getElementById("loading-screen").style.display = "flex";
      setTimeout(() => {
        document.getElementById("loading-screen").style.opacity = "0";
        setTimeout(() => {
          document.getElementById("loading-screen").style.display = "none";
          nextQuestion();
        }, 500);
      }, 2000);
    </script>
  </body>
</html>